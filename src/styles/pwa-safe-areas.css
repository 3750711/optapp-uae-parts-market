/* ========================================
   УНИВЕРСАЛЬНЫЕ Mobile Safe Areas
   Работают в PWA и обычном мобильном браузере
   ======================================== */

/* Детект PWA режима */
@media all and (display-mode: standalone) {
  :root {
    --pwa-mode: true;
  }
}

/* Fixed overlay с безопасными отступами */
.pwa-safe-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  
  /* Добавляем padding вместо inset для iOS safe-area */
  padding-top: env(safe-area-inset-top, 0px);
  padding-bottom: env(safe-area-inset-bottom, 0px);
  padding-left: env(safe-area-inset-left, 0px);
  padding-right: env(safe-area-inset-right, 0px);
}

/* Контент внутри safe overlay (должен быть в safe-zone) */
.pwa-safe-content {
  width: 100%;
  height: 100%;
  overflow: auto;
  -webkit-overflow-scrolling: touch;
}

/* Fixed элемент с safe top */
.pwa-safe-fixed-top {
  position: fixed;
  top: env(safe-area-inset-top, 0px);
  left: 0;
  right: 0;
  z-index: 50;
}

/* ========================================
   Базовые стили для ВСЕХ мобильных устройств
   ======================================== */

@media (max-width: 768px) {
  .mobile-sticky-bottom,
  .pwa-safe-fixed-bottom {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    z-index: 50;
    /* Базовый отступ для браузерной навигации */
    padding-bottom: 20px;
    
    /* Универсальные визуальные эффекты */
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    border-top: 1px solid rgba(0, 0, 0, 0.08);
    box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.05);
  }
  
  /* Progressive enhancement для PWA mode */
  @media (display-mode: standalone) {
    .mobile-sticky-bottom,
    .pwa-safe-fixed-bottom {
      /* В PWA используем safe-area-inset */
      bottom: env(safe-area-inset-bottom, 0px);
      padding-bottom: max(20px, env(safe-area-inset-bottom, 0px));
    }
  }
  
  /* iOS Safari специфичные правила */
  @supports (-webkit-touch-callout: none) {
    .mobile-sticky-bottom,
    .pwa-safe-fixed-bottom {
      /* В обычном Safari - увеличенный отступ для toolbar */
      padding-bottom: 24px;
    }
    
    /* В PWA на iOS - используем safe-area */
    @media (display-mode: standalone) {
      .mobile-sticky-bottom,
      .pwa-safe-fixed-bottom {
        padding-bottom: max(24px, env(safe-area-inset-bottom, 0px));
      }
    }
  }
}

/* Sticky с safe top */
.pwa-safe-sticky-top {
  position: sticky;
  top: env(safe-area-inset-top, 0px);
  z-index: 10;
}

/* Утилиты для margins */
.mt-safe {
  margin-top: env(safe-area-inset-top, 0px);
}

.mb-safe {
  margin-bottom: env(safe-area-inset-bottom, 0px);
}

.ml-safe {
  margin-left: env(safe-area-inset-left, 0px);
}

.mr-safe {
  margin-right: env(safe-area-inset-right, 0px);
}

/* iOS-специфичный фикс для нотча */
@supports (-webkit-touch-callout: none) {
  .pwa-safe-overlay {
    /* На iPhone X+ верхний inset ~44px, нижний ~34px */
    padding-top: max(env(safe-area-inset-top), 20px);
    padding-bottom: max(env(safe-area-inset-bottom), 20px);
  }
  
  .pwa-safe-fixed-top {
    top: max(env(safe-area-inset-top), 20px);
  }
  
  .pwa-safe-fixed-bottom {
    bottom: max(env(safe-area-inset-bottom), 20px);
  }
}

/* Android PWA (обычно safe-area = 0) */
@media (max-width: 768px) and (display-mode: standalone) {
  @supports not (-webkit-touch-callout: none) {
    .pwa-safe-overlay {
      /* Android: добавляем небольшой отступ сверху для status bar */
      padding-top: max(env(safe-area-inset-top), 24px);
    }
    
    .pwa-safe-fixed-top {
      top: max(env(safe-area-inset-top), 24px);
    }
  }
}

/* Debug mode (включается через data-debug-safe-area="true" на html) */
[data-debug-safe-area="true"] .pwa-safe-overlay {
  background: rgba(255, 0, 0, 0.1) !important;
  outline: 2px dashed red;
}

[data-debug-safe-area="true"] .pwa-safe-overlay::before {
  content: 'Safe Area Debug';
  position: absolute;
  top: env(safe-area-inset-top, 0px);
  left: 50%;
  transform: translateX(-50%);
  background: red;
  color: white;
  padding: 4px 8px;
  font-size: 10px;
  z-index: 99999;
}
